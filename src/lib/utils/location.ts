import type { Language } from '@versatiles/style';
import { timezone2countrycode } from './zones.js';

export function getCountryName(): string | null {
	try {
		const countryCode = getCountryCode();
		if (!countryCode) return null;
		const region = new Intl.DisplayNames(['en-GB'], { type: 'region' });
		const country = region.of(countryCode);
		return country || null;
	} catch {
		return null;
	}
}

export function getCountryCode(): string | null {
	try {
		const options = Intl.DateTimeFormat().resolvedOptions();
		let countryCode = timezone2countrycode(options.timeZone);
		if (!countryCode) countryCode = navigator.language.split('-')[1];
		return countryCode || null;
	} catch {
		return null;
	}
}

export function getLanguage(): Language {
	try {
		const language = Intl.DateTimeFormat().resolvedOptions().locale.split('-')[0].toLowerCase();
		switch (language) {
			case 'en':
			case 'de':
				return language;
		}
		return null;
	} catch {
		return null; // Fallback if no country can be determined
	}
}

const countryBoundingBoxes: { [key: string]: [number, number, number, number] } = {
	AF: [60.5, 29.3, 75.2, 38.5],
	AO: [11.6, -18, 24.1, -4.4],
	AL: [19.3, 39.6, 21.1, 42.7],
	AE: [51.5, 22.4, 56.4, 26.1],
	AR: [-73.5, -55.3, -53.6, -21.8],
	AM: [43.5, 38.7, 46.6, 41.3],
	AQ: [-180, -90, 180, -63.2],
	TF: [68.7, -49.8, 70.6, -48.6],
	AU: [113.3, -43.7, 153.6, -10.6],
	AT: [9.4, 46.4, 17, 49.1],
	AZ: [44.7, 38.2, 50.4, 41.9],
	BI: [29, -4.5, 30.8, -2.3],
	BE: [2.5, 49.5, 6.2, 51.5],
	BJ: [0.7, 6.1, 3.8, 12.3],
	BF: [-5.5, 9.6, 2.2, 15.2],
	BD: [88, 20.6, 92.7, 26.5],
	BG: [22.3, 41.2, 28.6, 44.3],
	BS: [-79, 23.7, -77, 27.1],
	BA: [15.7, 42.6, 19.6, 45.3],
	BY: [23.1, 51.3, 32.7, 56.2],
	BZ: [-89.3, 15.8, -88.1, 18.5],
	BO: [-69.6, -22.9, -57.4, -9.7],
	BR: [-74, -33.8, -34.7, 5.3],
	BN: [114.2, 4, 115.5, 5.5],
	BT: [88.8, 26.7, 92.2, 28.3],
	BW: [19.8, -26.9, 29.5, -17.6],
	CF: [14.4, 2.2, 27.4, 11.2],
	CA: [-141, 41.6, -52.6, 83.3],
	CH: [6, 45.7, 10.5, 47.9],
	CL: [-75.7, -55.7, -66.9, -17.5],
	CN: [73.6, 18.1, 135.1, 53.5],
	CI: [-8.7, 4.3, -2.5, 10.6],
	CM: [8.4, 1.7, 16.1, 12.9],
	CD: [12.1, -13.3, 31.2, 5.3],
	CG: [11, -5.1, 18.5, 3.8],
	CO: [-79, -4.3, -66.8, 12.5],
	CR: [-86, 8.2, -82.5, 11.3],
	CU: [-85, 19.8, -74.1, 23.2],
	CY: [32.2, 34.5, 34.1, 35.2],
	CZ: [12.2, 48.5, 18.9, 51.2],
	DE: [5.9, 47.3, 15.1, 55],
	DJ: [41.6, 10.9, 43.4, 12.7],
	DK: [8, 54.8, 12.7, 57.8],
	DO: [-72, 17.5, -68.3, 19.9],
	DZ: [-8.7, 19, 12, 37.2],
	EC: [-81, -5, -75.2, 1.4],
	EG: [24.7, 22, 36.9, 31.6],
	ER: [36.3, 12.4, 43.1, 18],
	ES: [-9.4, 35.9, 3.1, 43.8],
	EE: [23.3, 57.4, 28.2, 59.7],
	ET: [32.9, 3.4, 47.8, 15],
	FI: [20.6, 59.8, 31.6, 70.2],
	FJ: [-180, -18.3, 180, -16],
	FK: [-61.2, -52.3, -57.7, -51.1],
	FR: [-54.6, 2, 9.6, 51.2],
	GA: [8.7, -4, 14.5, 2.4],
	GB: [-7.6, 49.9, 1.7, 58.7],
	GE: [39.9, 41, 46.7, 43.6],
	GH: [-3.3, 4.7, 1.1, 11.1],
	GN: [-15.2, 7.3, -7.8, 12.6],
	GM: [-16.9, 13.1, -13.8, 13.9],
	GW: [-16.7, 11, -13.7, 12.7],
	GQ: [9.3, 1, 11.3, 2.3],
	GR: [20.1, 34.9, 26.7, 41.9],
	GL: [-73.3, 60, -12.2, 83.7],
	GT: [-92.3, 13.7, -88.2, 17.9],
	GY: [-61.5, 1.2, -56.5, 8.4],
	HN: [-89.4, 12.9, -83.1, 16.1],
	HR: [13.6, 42.4, 19.4, 46.6],
	HT: [-74.5, 18, -71.6, 20],
	HU: [16.2, 45.7, 22.8, 48.7],
	ID: [95.2, -10.4, 141.1, 5.5],
	IN: [68.1, 7.9, 97.5, 35.5],
	IE: [-10, 51.6, -6, 55.2],
	IR: [44.1, 25, 63.4, 39.8],
	IQ: [38.7, 29, 48.6, 37.4],
	IS: [-24.4, 63.4, -13.6, 66.6],
	IL: [34.2, 29.5, 35.9, 33.3],
	IT: [6.7, 36.6, 18.5, 47.2],
	JM: [-78.4, 17.7, -76.1, 18.6],
	JO: [34.9, 29.1, 39.2, 33.4],
	JP: [129.4, 31, 145.6, 45.6],
	KZ: [46.4, 40.6, 87.4, 55.4],
	KE: [33.8, -4.7, 41.9, 5.6],
	KG: [69.4, 39.2, 80.3, 43.3],
	KH: [102.3, 10.4, 107.7, 14.6],
	KR: [126.1, 34.3, 129.5, 38.7],
	KW: [46.5, 28.5, 48.5, 30.1],
	LA: [100.1, 13.8, 107.6, 22.5],
	LB: [35.1, 33, 36.7, 34.7],
	LR: [-11.5, 4.3, -7.5, 8.6],
	LY: [9.3, 19.5, 25.2, 33.2],
	LK: [79.6, 5.9, 81.8, 9.9],
	LS: [26.9, -30.7, 29.4, -28.6],
	LT: [21, 53.9, 26.6, 56.4],
	LU: [5.6, 49.4, 6.3, 50.2],
	LV: [21, 55.6, 28.2, 58],
	MA: [-17.1, 21.4, -1.1, 35.8],
	MD: [26.6, 45.4, 30.1, 48.5],
	MG: [43.2, -25.7, 50.5, -12],
	MX: [-117.2, 14.5, -86.8, 32.8],
	MK: [20.4, 40.8, 23, 42.4],
	ML: [-12.2, 10, 4.3, 25],
	MM: [92.3, 9.9, 101.2, 28.4],
	ME: [18.4, 41.8, 20.4, 43.6],
	MN: [87.7, 41.5, 119.8, 52.1],
	MZ: [30.1, -26.8, 40.8, -10.3],
	MR: [-17.1, 14.6, -4.9, 27.4],
	MW: [32.6, -16.9, 35.8, -9.2],
	MY: [100, 0.7, 119.2, 7],
	NA: [11.7, -29.1, 25.1, -16.9],
	NC: [164, -22.4, 167.2, -20.1],
	NE: [0.2, 11.6, 16, 23.5],
	NG: [2.6, 4.2, 14.6, 13.9],
	NI: [-87.7, 10.7, -83.1, 15.1],
	NL: [3.3, 50.8, 7.1, 53.6],
	NO: [4.9, 58, 31.3, 80.7],
	NP: [80, 26.3, 88.2, 30.5],
	NZ: [166.5, -46.7, 178.6, -34.4],
	OM: [52, 16.6, 59.9, 26.4],
	PK: [60.8, 23.6, 77.9, 37.2],
	PA: [-83, 7.2, -77.2, 9.7],
	PE: [-81.5, -18.4, -68.6, 0],
	PH: [117.1, 5.5, 126.6, 18.6],
	PG: [141, -10.7, 156.1, -2.5],
	PL: [14, 49, 24.1, 54.9],
	PR: [-67.3, 17.9, -65.5, 18.6],
	KP: [124.2, 37.6, 130.8, 43],
	PT: [-9.6, 36.8, -6.3, 42.3],
	PY: [-62.7, -27.6, -54.2, -19.3],
	QA: [50.7, 24.5, 51.7, 26.2],
	RO: [20.2, 43.6, 29.7, 48.3],
	RU: [-180, 41.1, 180, 81.3],
	RW: [29, -3, 30.9, -1.1],
	SA: [34.6, 16.3, 55.7, 32.2],
	SD: [21.9, 8.6, 38.5, 22],
	SS: [23.8, 3.5, 35.3, 12.3],
	SN: [-17.7, 12.3, -11.4, 16.6],
	SB: [156.4, -10.9, 162.4, -6.5],
	SL: [-13.3, 6.7, -10.2, 10.1],
	SV: [-90.1, 13.1, -87.7, 14.5],
	SO: [40.9, -1.7, 51.2, 12.1],
	RS: [18.8, 42.2, 23, 46.2],
	SR: [-58.1, 1.8, -53.9, 6.1],
	SK: [16.8, 47.7, 22.6, 49.6],
	SI: [13.6, 45.4, 16.6, 46.9],
	SE: [11, 55.3, 24, 69.2],
	SZ: [30.6, -27.3, 32.1, -25.6],
	SY: [35.7, 32.3, 42.4, 37.3],
	TD: [13.5, 7.4, 23.9, 23.5],
	TG: [-0.1, 5.9, 1.9, 11.1],
	TH: [97.3, 5.6, 105.6, 20.5],
	TJ: [67.4, 36.7, 75, 41],
	TM: [52.5, 35.2, 66.6, 42.8],
	TL: [124.9, -9.4, 127.4, -8.2],
	TT: [-62, 10, -60.8, 10.9],
	TN: [7.5, 30.3, 11.5, 37.4],
	TR: [26, 35.8, 44.8, 42.2],
	TW: [120.1, 21.9, 122, 25.3],
	TZ: [29.3, -11.8, 40.4, -0.9],
	UG: [29.5, -1.5, 35.1, 4.3],
	UA: [22, 44.3, 40.1, 52.4],
	UY: [-58.5, -35, -53.2, -30.1],
	US: [-171.8, 18.9, -66.9, 71.4],
	UZ: [55.9, 37.1, 73.1, 45.6],
	VE: [-73.4, 0.7, -59.7, 12.2],
	VN: [102.1, 8.5, 109.4, 23.4],
	VU: [166.6, -16.6, 167.9, -14.6],
	PS: [34.9, 31.3, 35.6, 32.6],
	YE: [42.6, 12.5, 53.2, 19.1],
	ZA: [16.3, -34.9, 32.9, -22],
	ZM: [21.8, -18, 33.5, -8.2],
	ZW: [25.2, -22.3, 32.9, -15.5]
};

export function getCountryBoundingBox(): [number, number, number, number] | null {
	const countryCode = getCountryCode();
	if (!countryCode) return null;
	return countryBoundingBoxes[countryCode] ?? null;
}
